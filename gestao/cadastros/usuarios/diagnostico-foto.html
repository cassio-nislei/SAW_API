<!doctype html>
<html>
  <head>
    <title>Diagn√≥stico - Upload de Foto</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
      }
      .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .ok {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      h1 {
        color: #333;
      }
      .console {
        background: #222;
        color: #0f0;
        padding: 15px;
        border-radius: 4px;
        font-family: monospace;
        height: 300px;
        overflow-y: auto;
        margin-top: 20px;
      }
      button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Diagn√≥stico - Upload de Foto do Usu√°rio</h1>

      <div id="diagnostico"></div>

      <h2>Console de Debug</h2>
      <div class="console" id="console"></div>

      <button onclick="testarFuncoes()">Testar Fun√ß√µes</button>
      <button onclick="limparConsole()">Limpar Console</button>
    </div>

    <script>
      let consoleLogs = [];

      // Override console.log para capturar logs
      const originalLog = console.log;
      const originalWarn = console.warn;
      const originalError = console.error;

      function adicionarLog(tipo, msg) {
        const timestamp = new Date().toLocaleTimeString();
        consoleLogs.push(`[${timestamp}] ${tipo}: ${msg}`);
        atualizarConsole();
      }

      console.log = function (...args) {
        originalLog.apply(console, args);
        adicionarLog("LOG", args.join(" "));
      };

      console.warn = function (...args) {
        originalWarn.apply(console, args);
        adicionarLog("WARN", args.join(" "));
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        adicionarLog("ERROR", args.join(" "));
      };

      function atualizarConsole() {
        const consoleDiv = document.getElementById("console");
        consoleDiv.innerHTML = consoleLogs.join("<br>");
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      }

      function limparConsole() {
        consoleLogs = [];
        atualizarConsole();
      }

      function adicionarStatus(titulo, ok, msg) {
        const classeStatus = ok ? "ok" : "error";
        const icon = ok ? "‚úì" : "‚úó";
        const html = `<div class="status ${classeStatus}">${icon} <strong>${titulo}:</strong> ${msg}</div>`;
        document.getElementById("diagnostico").innerHTML += html;
      }

      function testarFuncoes() {
        consoleLogs = [];
        document.getElementById("diagnostico").innerHTML = "";

        console.log("üîç Iniciando diagn√≥stico...");

        // Teste 1: jQuery
        if (typeof jQuery !== "undefined") {
          adicionarStatus(
            "jQuery",
            true,
            `Carregado (vers√£o ${jQuery.fn.jquery})`,
          );
          console.log("‚úì jQuery est√° dispon√≠vel");
        } else {
          adicionarStatus("jQuery", false, "N√ÉO CARREGADO");
          console.error("‚úó jQuery n√£o foi encontrado!");
          return;
        }

        // Teste 2: Elementos HTML
        const elementos = {
          btnFotoCamera: "#btnFotoCamera",
          btnFotoGaleria: "#btnFotoGaleria",
          btnLimparFoto: "#btnLimparFoto",
          "input-foto-usuario": "#input-foto-usuario",
          "foto-base64": "#foto-base64",
          "camera-modal": "#camera-modal",
          "preview-foto": "#preview-foto",
        };

        for (const [nome, seletor] of Object.entries(elementos)) {
          const existe = jQuery(seletor).length > 0;
          adicionarStatus(
            `Elemento ${nome}`,
            existe,
            existe ? "Encontrado" : "N√ÉO ENCONTRADO",
          );
          console.log(
            existe ? `‚úì ${seletor} existe` : `‚úó ${seletor} n√£o existe`,
          );
        }

        // Teste 3: Fun√ß√£o initFotoUpload
        if (typeof initFotoUpload === "function") {
          adicionarStatus("Fun√ß√£o initFotoUpload", true, "Definida");
          console.log("‚úì Fun√ß√£o initFotoUpload est√° definida");

          // Teste 4: Chamada da fun√ß√£o
          try {
            console.log("Chamando initFotoUpload()...");
            initFotoUpload();
            adicionarStatus(
              "Chamada initFotoUpload()",
              true,
              "Executada com sucesso",
            );
            console.log("‚úì initFotoUpload() executado");
          } catch (e) {
            adicionarStatus(
              "Chamada initFotoUpload()",
              false,
              `Erro: ${e.message}`,
            );
            console.error(`‚úó Erro ao chamar initFotoUpload: ${e.message}`);
          }
        } else {
          adicionarStatus("Fun√ß√£o initFotoUpload", false, "N√ÉO DEFINIDA");
          console.error("‚úó Fun√ß√£o initFotoUpload n√£o foi encontrada");
        }

        // Teste 5: mostraDialogo
        if (typeof mostraDialogo === "function") {
          adicionarStatus("Fun√ß√£o mostraDialogo", true, "Definida");
          console.log("‚úì Fun√ß√£o mostraDialogo est√° dispon√≠vel");
        } else {
          adicionarStatus(
            "Fun√ß√£o mostraDialogo",
            false,
            "N√ÉO DEFINIDA (vai precisar estar em conversa)",
          );
          console.warn(
            "‚ö† Fun√ß√£o mostraDialogo n√£o dispon√≠vel (ser√° carregada em conversas.php)",
          );
        }

        console.log("‚úì Diagn√≥stico conclu√≠do!");
      }

      // Rodar diagn√≥stico automaticamente ao carregar
      window.addEventListener("load", function () {
        setTimeout(testarFuncoes, 100);
      });
    </script>
  </body>
</html>
