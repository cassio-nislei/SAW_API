{
  "openapi": "3.0.0",
  "info": {
    "title": "SAW API - Sistema de Atendimento Web",
    "description": "API RESTful completa em PHP puro para gerenciamento de atendimentos, mensagens, anexos, contatos, agendamentos e configurações. Suporta JWT para autenticação.",
    "version": "2.0.0",
    "contact": {
      "name": "Suporte SAW",
      "email": "suporte@saw.local"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost/SAW-main/api/v1",
      "description": "Servidor de Desenvolvimento"
    },
    {
      "url": "http://104.234.173.105:7080/api/v1",
      "description": "Servidor de Produção"
    },
    {
      "url": "https://api.saw.local/v1",
      "description": "Servidor de Produção HTTPS"
    }
  ],
  "tags": [
    { "name": "Health", "description": "Status e verificação da API" },
    { "name": "Autenticação", "description": "Endpoints de autenticação" },
    { "name": "Atendimentos", "description": "Gerenciamento de atendimentos" },
    { "name": "Mensagens", "description": "Gerenciamento de mensagens" },
    { "name": "Anexos", "description": "Upload e gerenciamento de anexos" },
    { "name": "Contatos", "description": "Gerenciamento de contatos" },
    { "name": "Agendamentos", "description": "Gerenciamento de agendamentos" },
    { "name": "Parâmetros", "description": "Configurações do sistema" },
    { "name": "Menus", "description": "Gerenciamento de menus" },
    { "name": "Respostas", "description": "Respostas automáticas" },
    { "name": "Horários", "description": "Horários de funcionamento" },
    {
      "name": "Departamentos",
      "description": "Gerenciamento de departamentos"
    },
    { "name": "Avisos", "description": "Gerenciamento de avisos" }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["Health"],
        "summary": "Health Check",
        "description": "Verifica se a API está funcionando",
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "description": "API operacional",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SuccessResponse" }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "Login",
        "description": "Autentica usuário e retorna token JWT",
        "operationId": "authLogin",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "login": { "type": "string", "example": "admin" },
                  "senha": { "type": "string", "example": "123456" }
                },
                "required": ["login", "senha"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login bem-sucedido",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/LoginResponse" }
              }
            }
          },
          "401": { "description": "Credenciais inválidas" }
        }
      }
    },
    "/atendimentos": {
      "get": {
        "tags": ["Atendimentos"],
        "summary": "Listar atendimentos",
        "operationId": "listAtendimentos",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "default": 1 }
          },
          {
            "name": "perPage",
            "in": "query",
            "schema": { "type": "integer", "default": 20 }
          },
          { "name": "situacao", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Lista de atendimentos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AtendimentoListResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Atendimentos"],
        "summary": "Criar novo atendimento (P2: sprGeraNovoAtendimento)",
        "operationId": "createAtendimento",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "numero": {
                    "type": "string",
                    "description": "Número de telefone/identificador"
                  },
                  "nome": {
                    "type": "string",
                    "description": "Nome do cliente"
                  },
                  "id_atendente": {
                    "type": "integer",
                    "description": "ID do atendente (opcional)"
                  },
                  "nome_atendente": {
                    "type": "string",
                    "description": "Nome do atendente (opcional)"
                  },
                  "situacao": {
                    "type": "string",
                    "enum": ["P", "A", "T", "F"],
                    "description": "Pendente, Atendendo, Triagem, Finalizado (padrão: P)"
                  },
                  "canal": {
                    "type": "string",
                    "description": "Canal de comunicação: WhatsApp, Telegram, Chat, Email (opcional)"
                  },
                  "setor": {
                    "type": "string",
                    "description": "Setor responsável (opcional)"
                  }
                },
                "required": ["numero", "nome"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Atendimento criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sucesso": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "login": { "type": "string" },
                        "nome": { "type": "string" },
                        "situacao": { "type": "string" }
                      }
                    },
                    "mensagem": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": { "description": "Parâmetros obrigatórios ausentes" },
          "500": { "description": "Erro ao criar atendimento" }
        }
      }
    },
    "/atendimentos/verificar-pendente": {
      "post": {
        "tags": ["Atendimentos"],
        "summary": "Verificar atendimento pendente",
        "operationId": "verificarAtendimentoPendente",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "numero": { "type": "string" }
                },
                "required": ["numero"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Verificação concluída" }
        }
      }
    },
    "/atendimentos/finalizar": {
      "post": {
        "tags": ["Atendimentos"],
        "summary": "Finalizar atendimento",
        "operationId": "finalizarAtendimento",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" },
                  "observacao": { "type": "string" }
                },
                "required": ["id"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Atendimento finalizado" },
          "404": { "description": "Atendimento não encontrado" }
        }
      }
    },
    "/atendimentos/gravar-mensagem": {
      "post": {
        "tags": ["Mensagens"],
        "summary": "Gravar mensagem em atendimento",
        "operationId": "gravarMensagemAtendimento",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "id_atendimento": { "type": "integer" },
                  "mensagem": { "type": "string" },
                  "arquivo": { "type": "string", "format": "binary" }
                },
                "required": ["id_atendimento", "mensagem"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Mensagem gravada" },
          "400": { "description": "Dados inválidos" }
        }
      }
    },
    "/atendimentos/atualizar-setor": {
      "put": {
        "tags": ["Atendimentos"],
        "summary": "Atualizar setor do atendimento",
        "operationId": "atualizarSetorAtendimento",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" },
                  "setor": { "type": "string" }
                },
                "required": ["id", "setor"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Setor atualizado" }
        }
      }
    },
    "/atendimentos/inativos": {
      "get": {
        "tags": ["Atendimentos"],
        "summary": "Listar atendimentos inativos",
        "operationId": "listarAtendimentosInativos",
        "responses": {
          "200": { "description": "Lista de atendimentos inativos" }
        }
      }
    },
    "/mensagens/verificar-duplicada": {
      "post": {
        "tags": ["Mensagens"],
        "summary": "Verificar mensagem duplicada",
        "operationId": "verificarMensagemDuplicada",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "conteudo": { "type": "string" },
                  "remetente": { "type": "string" }
                },
                "required": ["conteudo"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Verificação concluída" }
        }
      }
    },
    "/mensagens/status-multiplas": {
      "post": {
        "tags": ["Mensagens"],
        "summary": "Obter status de múltiplas mensagens",
        "operationId": "getStatusMultiplasMensagens",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ids": { "type": "array", "items": { "type": "integer" } }
                },
                "required": ["ids"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Status retornado" }
        }
      }
    },
    "/mensagens/pendentes-envio": {
      "get": {
        "tags": ["Mensagens"],
        "summary": "Listar mensagens pendentes de envio",
        "operationId": "listMensagensParaEnviar",
        "responses": {
          "200": { "description": "Lista de mensagens pendentes" }
        }
      }
    },
    "/mensagens/proxima-sequencia": {
      "get": {
        "tags": ["Mensagens"],
        "summary": "Obter próxima sequência de mensagem",
        "operationId": "proximaSequenciaMensagem",
        "parameters": [
          {
            "name": "id_atendimento",
            "in": "query",
            "schema": { "type": "integer" },
            "required": true
          }
        ],
        "responses": {
          "200": { "description": "Próxima sequência retornada" }
        }
      }
    },
    "/mensagens/marcar-excluida": {
      "put": {
        "tags": ["Mensagens"],
        "summary": "Marcar mensagem como excluída",
        "operationId": "marcarMensagemExcluida",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" }
                },
                "required": ["id"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Mensagem marcada como excluída" }
        }
      }
    },
    "/mensagens/marcar-reacao": {
      "post": {
        "tags": ["Mensagens"],
        "summary": "Marcar reação na mensagem",
        "operationId": "marcarMensagemReacao",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" },
                  "reacao": { "type": "integer" }
                },
                "required": ["id", "reacao"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Reação marcada" }
        }
      }
    },
    "/mensagens/marcar-enviada": {
      "put": {
        "tags": ["Mensagens"],
        "summary": "Marcar mensagem como enviada",
        "operationId": "marcarMensagemEnviada",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": { "type": "integer" }
                },
                "required": ["id"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Mensagem marcada como enviada" }
        }
      }
    },
    "/mensagens/comparar-duplicacao": {
      "post": {
        "tags": ["Mensagens"],
        "summary": "Comparar duplicação de mensagem",
        "operationId": "compararDuplicacaoMensagem",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "mensagem1": { "type": "string" },
                  "mensagem2": { "type": "string" }
                },
                "required": ["mensagem1", "mensagem2"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Comparação concluída" }
        }
      }
    },
    "/contatos/exportar": {
      "get": {
        "tags": ["Contatos"],
        "summary": "Exportar contatos",
        "operationId": "exportarContatos",
        "parameters": [
          {
            "name": "formato",
            "in": "query",
            "schema": { "type": "string", "enum": ["json", "csv", "xlsx"] },
            "description": "Formato de exportação"
          }
        ],
        "responses": {
          "200": { "description": "Contatos exportados" }
        }
      }
    },
    "/contatos/buscar-nome": {
      "get": {
        "tags": ["Contatos"],
        "summary": "Buscar contato por nome",
        "operationId": "buscarNomeContato",
        "parameters": [
          {
            "name": "nome",
            "in": "query",
            "schema": { "type": "string" },
            "required": true
          }
        ],
        "responses": {
          "200": { "description": "Contatos encontrados" }
        }
      }
    },
    "/agendamentos/pendentes": {
      "get": {
        "tags": ["Agendamentos"],
        "summary": "Listar agendamentos pendentes",
        "operationId": "listarAgendamentosPendentes",
        "responses": {
          "200": { "description": "Agendamentos pendentes" }
        }
      }
    },
    "/parametros/sistema": {
      "get": {
        "tags": ["Parâmetros"],
        "summary": "Obter parâmetros do sistema",
        "operationId": "getParametrosSistema",
        "responses": {
          "200": { "description": "Parâmetros do sistema" }
        }
      }
    },
    "/parametros/verificar-expediente": {
      "get": {
        "tags": ["Parâmetros"],
        "summary": "Verificar expediente",
        "operationId": "verificarExpediente",
        "responses": {
          "200": { "description": "Status do expediente" }
        }
      }
    },
    "/menus/principal": {
      "get": {
        "tags": ["Menus"],
        "summary": "Obter menu principal",
        "operationId": "getMenuPrincipal",
        "responses": {
          "200": { "description": "Menu principal" }
        }
      }
    },
    "/menus/submenus": {
      "get": {
        "tags": ["Menus"],
        "summary": "Obter submenus",
        "operationId": "getSubmenus",
        "parameters": [
          {
            "name": "id_menu",
            "in": "query",
            "schema": { "type": "integer" },
            "required": false
          }
        ],
        "responses": {
          "200": { "description": "Submenus" }
        }
      }
    },
    "/respostas/respostas-automaticas": {
      "get": {
        "tags": ["Respostas"],
        "summary": "Obter respostas automáticas",
        "operationId": "getRespostasAutomaticas",
        "responses": {
          "200": { "description": "Respostas automáticas" }
        }
      }
    },
    "/departamentos/por-menu": {
      "get": {
        "tags": ["Departamentos"],
        "summary": "Obter departamentos por menu",
        "operationId": "getDepartamentoPorMenu",
        "parameters": [
          {
            "name": "id_menu",
            "in": "query",
            "schema": { "type": "integer" },
            "required": true
          }
        ],
        "responses": {
          "200": { "description": "Departamentos" }
        }
      }
    },
    "/avisos/registrar": {
      "post": {
        "tags": ["Avisos"],
        "summary": "Registrar aviso",
        "operationId": "registrarAvisoSemExpediente",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "numero": { "type": "string" },
                  "mensagem": { "type": "string" }
                },
                "required": ["numero", "mensagem"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Aviso registrado" }
        }
      }
    },
    "/avisos/limpar-antigos": {
      "delete": {
        "tags": ["Avisos"],
        "summary": "Limpar avisos antigos",
        "operationId": "limparAvisoAntigos",
        "parameters": [
          {
            "name": "dias",
            "in": "query",
            "schema": { "type": "integer", "default": 30 }
          }
        ],
        "responses": {
          "200": { "description": "Avisos antigos removidos" }
        }
      }
    },
    "/avisos/limpar-numero": {
      "delete": {
        "tags": ["Avisos"],
        "summary": "Limpar avisos por número",
        "operationId": "limparAvisoNumero",
        "parameters": [
          {
            "name": "numero",
            "in": "query",
            "schema": { "type": "string" },
            "required": true
          }
        ],
        "responses": {
          "200": { "description": "Avisos removidos" }
        }
      }
    },
    "/avisos/verificar-existente": {
      "get": {
        "tags": ["Avisos"],
        "summary": "Verificar aviso existente",
        "operationId": "verificarAvisoExistente",
        "parameters": [
          {
            "name": "numero",
            "in": "query",
            "schema": { "type": "string" },
            "required": true
          }
        ],
        "responses": {
          "200": { "description": "Aviso verificado" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "sucesso": { "type": "boolean", "example": true },
          "mensagem": { "type": "string" },
          "dados": { "type": "object" }
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "sucesso": { "type": "boolean", "example": true },
          "dados": {
            "type": "object",
            "properties": {
              "token": { "type": "string" },
              "refresh_token": { "type": "string" },
              "usuario": { "type": "object" }
            }
          }
        }
      },
      "AtendimentoListResponse": {
        "type": "object",
        "properties": {
          "sucesso": { "type": "boolean" },
          "dados": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "integer" },
                "numero": { "type": "string" },
                "nome": { "type": "string" },
                "situacao": { "type": "string" },
                "canal": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
