# SAW API v1 - Diagramas e Fluxos

## ğŸ—ï¸ Arquitetura da API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENTE (Frontend)                           â”‚
â”‚                    (Browser/Mobile/Desktop App)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP Request
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SAW API v1 Gateway                              â”‚
â”‚                     http://localhost/api/v1/                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Router (index.php)                              â”‚   â”‚
â”‚  â”‚  â€¢ AnÃ¡lise de requisiÃ§Ã£o                                     â”‚   â”‚
â”‚  â”‚  â€¢ Matching de rota                                          â”‚   â”‚
â”‚  â”‚  â€¢ ExtraÃ§Ã£o de parÃ¢metros                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Controllers                                     â”‚   â”‚
â”‚  â”‚  â€¢ AtendimentoController (7 methods)                         â”‚   â”‚
â”‚  â”‚  â€¢ MensagemController (7 methods)                            â”‚   â”‚
â”‚  â”‚  â€¢ ParametroController (2 methods)                           â”‚   â”‚
â”‚  â”‚  â€¢ MenuController (4 methods)                                â”‚   â”‚
â”‚  â”‚  â€¢ HorarioController (2 methods)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Models                                          â”‚   â”‚
â”‚  â”‚  â€¢ Atendimento::query()                                      â”‚   â”‚
â”‚  â”‚  â€¢ Mensagem::create()                                        â”‚   â”‚
â”‚  â”‚  â€¢ Anexo::delete()                                           â”‚   â”‚
â”‚  â”‚  â€¢ Menu::getById()                                           â”‚   â”‚
â”‚  â”‚  â€¢ Horario::isOpen()                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Database Layer (Database.php)                   â”‚   â”‚
â”‚  â”‚  â€¢ Prepared Statements                                       â”‚   â”‚
â”‚  â”‚  â€¢ ConexÃ£o Ãºnica                                             â”‚   â”‚
â”‚  â”‚  â€¢ Transaction control                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   MySQL Database     â”‚
                          â”‚   (saw15)            â”‚
                          â”‚                      â”‚
                          â”‚ â€¢ tbatendimento      â”‚
                          â”‚ â€¢ tbmsgatendimento   â”‚
                          â”‚ â€¢ tbanexos           â”‚
                          â”‚ â€¢ tbparametros       â”‚
                          â”‚ â€¢ tbmenu             â”‚
                          â”‚ â€¢ tbhorarios         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Fluxo de RequisiÃ§Ã£o

```
1. ENTRADA (HTTP Request)
   â”‚
   â”œâ”€ GET /atendimentos?page=1&perPage=20
   â”œâ”€ POST /atendimentos
   â”œâ”€ PUT /atendimentos/1/situacao
   â””â”€ DELETE /mensagens/123
   â”‚
   â–¼

2. ROUTING
   â”‚
   â”œâ”€ AnÃ¡lise da URL
   â”œâ”€ ExtraÃ§Ã£o de mÃ©todo HTTP
   â”œâ”€ Matching com rotas registradas
   â””â”€ ExtraÃ§Ã£o de parÃ¢metros
   â”‚
   â–¼

3. CONTROLADOR
   â”‚
   â”œâ”€ ValidaÃ§Ã£o de entrada
   â”œâ”€ Tratamento de erros
   â”œâ”€ Chamada ao Model
   â””â”€ PreparaÃ§Ã£o de resposta
   â”‚
   â–¼

4. MODEL
   â”‚
   â”œâ”€ ConstruÃ§Ã£o de SQL
   â”œâ”€ Prepared Statement
   â”œâ”€ ExecuÃ§Ã£o via Database
   â””â”€ Retorno de dados
   â”‚
   â–¼

5. DATABASE
   â”‚
   â”œâ”€ Query ao MySQL
   â”œâ”€ Processamento
   â””â”€ Retorno de resultado
   â”‚
   â–¼

6. RESPOSTA
   â”‚
   â”œâ”€ Status HTTP (200, 400, 404, 500)
   â”œâ”€ JSON Response
   â”œâ”€ Headers CORS
   â””â”€ Timestamp
   â”‚
   â–¼

7. SAÃDA (Response)
   â”‚
   {
     "status": "success|error",
     "message": "...",
     "data": {...},
     "timestamp": "2025-11-19 10:30:00"
   }
```

---

## ğŸ”„ Ciclo de Vida de uma RequisiÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Browser envia: GET /atendimentos    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 2. Apache intercepta
        â”‚    Reescreve para
        â”‚    index.php
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 3. PHP inicia
        â”‚    Carrega config.php
        â”‚    Carrega Router
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 4. Router analisa
        â”‚    GET /atendimentos
        â”‚    â†“ match com rota
        â”‚    AtendimentoController::list()
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 5. Controller
        â”‚    Extrai params
        â”‚    Valida entrada
        â”‚    Chama Atendimento::list()
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 6. Model
        â”‚    ConstrÃ³i SQL
        â”‚    Database::query()
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 7. Database
        â”‚    Prepared Stmt
        â”‚    MySQL SELECT
        â”‚    Retorna dados
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 8. Response::paginated()
        â”‚    Status: 200
        â”‚    JSON com dados
        â”‚    Pagination info
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 9. Response enviada
        â”‚    HTTP 200
        â”‚    JSON
        â”‚    Timestamp
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 10. Browser recebe
        â”‚     Processa JSON
        â”‚     Atualiza UI
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Estrutura de Classes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENTRADA (Router)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚
          â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Controlador      â”‚Response  â”‚   â”‚Database  â”‚
    â”‚Atendimento      â”‚          â”‚   â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â”œâ”€ list()                       â”‚
         â”œâ”€ create()                     â”‚
         â”œâ”€ getById()                    â”‚
         â”œâ”€ updateSituacao()             â”‚
         â”œâ”€ updateSetor()                â”‚
         â”œâ”€ finalize()                   â”‚
         â””â”€ listActive()                 â”‚
                  â”‚                      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Atendimento   â”‚
                    â”‚  (Model)       â”‚
                    â”‚                â”‚
                    â”‚ - query()      â”‚
                    â”‚ - execute()    â”‚
                    â”‚ - getById()    â”‚
                    â”‚ - list()       â”‚
                    â”‚ - create()     â”‚
                    â”‚ - update()     â”‚
                    â”‚ - delete()     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MySQL        â”‚
                    â”‚                â”‚
                    â”‚ tbatendimento  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Fluxo de URLs

```
REWRITE (Apache)
â”œâ”€ Entrada: /SAW-main/api/v1/atendimentos?page=1
â”œâ”€ Reescrita para: /SAW-main/api/v1/index.php
â”œâ”€ PATH_INFO: /atendimentos?page=1
â””â”€ Router::dispatch()
   â”‚
   â”œâ”€ GET /atendimentos
   â”‚  â””â”€ AtendimentoController::list()
   â”‚
   â”œâ”€ POST /atendimentos
   â”‚  â””â”€ AtendimentoController::create()
   â”‚
   â”œâ”€ GET /atendimentos/{id}
   â”‚  â””â”€ AtendimentoController::getById($id)
   â”‚
   â”œâ”€ PUT /atendimentos/{id}/situacao
   â”‚  â””â”€ AtendimentoController::updateSituacao($id)
   â”‚
   â”œâ”€ POST /atendimentos/{id}/mensagens
   â”‚  â””â”€ MensagemController::create($id)
   â”‚
   â”œâ”€ DELETE /mensagens/{id}
   â”‚  â””â”€ MensagemController::delete($id)
   â”‚
   â””â”€ ... (24 rotas no total)
```

---

## ğŸ—‚ï¸ SeparaÃ§Ã£o de Responsabilidades

```
CAMADA APRESENTAÃ‡ÃƒO (Frontend)
â”œâ”€ Browser/App/Desktop
â”œâ”€ Faz requisiÃ§Ãµes HTTP
â””â”€ Consome API
    â”‚
    â–¼
CAMADA ROTEAMENTO (Router)
â”œâ”€ Analisa requisiÃ§Ãµes
â”œâ”€ Matching de rotas
â””â”€ Chama controllers
    â”‚
    â–¼
CAMADA LÃ“GICA (Controllers)
â”œâ”€ ValidaÃ§Ã£o de entrada
â”œâ”€ OrquestraÃ§Ã£o de operaÃ§Ãµes
â”œâ”€ Tratamento de erros
â””â”€ Chama models
    â”‚
    â–¼
CAMADA DADOS (Models)
â”œâ”€ LÃ³gica de negÃ³cio
â”œâ”€ ConstruÃ§Ã£o de SQL
â”œâ”€ OperaÃ§Ãµes CRUD
â””â”€ Chama Database
    â”‚
    â–¼
CAMADA BANCO (Database)
â”œâ”€ ConexÃ£o MySQL
â”œâ”€ Prepared Statements
â”œâ”€ ExecuÃ§Ã£o de queries
â””â”€ ProteÃ§Ã£o contra SQL Injection
    â”‚
    â–¼
BANCO DE DADOS (MySQL)
â”œâ”€ Armazenamento persistente
â”œâ”€ Integridade de dados
â””â”€ Performance
```

---

## ğŸ” Fluxo de SeguranÃ§a

```
ENTRADA (HTTP Request)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. RECEBIMENTO          â”‚
â”‚ â”œâ”€ ValidaÃ§Ã£o de mÃ©todo  â”‚
â”‚ â”œâ”€ ValidaÃ§Ã£o de URL     â”‚
â”‚ â””â”€ Parsing de JSON      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ROTEAMENTO           â”‚
â”‚ â”œâ”€ VerificaÃ§Ã£o de rota  â”‚
â”‚ â”œâ”€ ExtraÃ§Ã£o de params   â”‚
â”‚ â””â”€ ValidaÃ§Ã£o de tipos   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. VALIDAÃ‡ÃƒO            â”‚
â”‚ â”œâ”€ Campos obrigatÃ³rios  â”‚
â”‚ â”œâ”€ Tipos de dados       â”‚
â”‚ â”œâ”€ Ranges de valores    â”‚
â”‚ â””â”€ Formato de entrada   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. PREPARED STATEMENTS  â”‚
â”‚ â”œâ”€ ParametrizaÃ§Ã£o       â”‚
â”‚ â”œâ”€ Escape de strings    â”‚
â”‚ â””â”€ Type binding         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. EXECUÃ‡ÃƒO             â”‚
â”‚ â”œâ”€ Query safe           â”‚
â”‚ â”œâ”€ Sem SQL injection    â”‚
â”‚ â””â”€ Resultado seguro     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. RESPOSTA             â”‚
â”‚ â”œâ”€ JSON encoding        â”‚
â”‚ â”œâ”€ Sem exposiÃ§Ã£o de BD  â”‚
â”‚ â”œâ”€ CORS headers         â”‚
â”‚ â””â”€ Status codes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Fluxo de Dados (Exemplo: Criar Atendimento)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REQUEST                                              â”‚
â”‚ POST /atendimentos                                   â”‚
â”‚ {                                                    â”‚
â”‚   "numero": "5521999999999",                        â”‚
â”‚   "nome": "JoÃ£o",                                   â”‚
â”‚   "idAtende": 1,                                    â”‚
â”‚   "nomeAtende": "Maria"                             â”‚
â”‚ }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ AtendimentoController        â”‚
            â”‚ ::create()                  â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚ 1. Validar entrada          â”‚
            â”‚ 2. Verificar existÃªncia     â”‚
            â”‚ 3. Gerar novo ID            â”‚
            â”‚ 4. Chamar Model             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Atendimento::create()      â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ 1. Construir INSERT SQL    â”‚
          â”‚ 2. Preparar parÃ¢metros     â”‚
          â”‚ 3. Executar query          â”‚
          â”‚ 4. Retornar novo registro  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Database::execute()         â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ INSERT INTO tbatendimento   â”‚
        â”‚ (id, situacao, nome, ...)   â”‚
        â”‚ VALUES (?, ?, ?, ...)       â”‚
        â”‚ PARAMETERS BOUND            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ MySQL        â”‚
              â”‚ Insere dado  â”‚
              â”‚ Retorna ID   â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Model retorna novo registro â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Response::success()         â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ Status: 201 (Created)       â”‚
        â”‚ JSON com novo atendimento   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPONSE                                             â”‚
â”‚ {                                                    â”‚
â”‚   "status": "success",                              â”‚
â”‚   "message": "Atendimento criado com sucesso",      â”‚
â”‚   "data": {                                          â”‚
â”‚     "id": 1,                                         â”‚
â”‚     "situacao": "P",                                â”‚
â”‚     "numero": "5521999999999",                      â”‚
â”‚     "nome": "JoÃ£o",                                 â”‚
â”‚     "dt_atend": "2025-11-19",                       â”‚
â”‚     "hr_atend": "10:30:00"                          â”‚
â”‚   },                                                 â”‚
â”‚   "timestamp": "2025-11-19 10:30:00"                â”‚
â”‚ }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Mapeamento de RequisiÃ§Ãµes

```
â”Œâ”€ Atendimentos (7)
â”‚  â”œâ”€ GET / â†’ list()
â”‚  â”œâ”€ POST / â†’ create()
â”‚  â”œâ”€ GET /ativos â†’ listActive()
â”‚  â”œâ”€ GET /{id} â†’ getById()
â”‚  â”œâ”€ PUT /{id}/situacao â†’ updateSituacao()
â”‚  â”œâ”€ PUT /{id}/setor â†’ updateSetor()
â”‚  â””â”€ POST /{id}/finalizar â†’ finalize()
â”‚
â”œâ”€ Mensagens (7)
â”‚  â”œâ”€ GET /atendimentos/{id}/mensagens â†’ list()
â”‚  â”œâ”€ POST /atendimentos/{id}/mensagens â†’ create()
â”‚  â”œâ”€ GET /atendimentos/{id}/mensagens/pendentes â†’ listPending()
â”‚  â”œâ”€ PUT /mensagens/{id}/situacao â†’ updateSituacao()
â”‚  â”œâ”€ PUT /mensagens/{id}/visualizar â†’ markAsViewed()
â”‚  â”œâ”€ POST /mensagens/{id}/reacao â†’ addReaction()
â”‚  â””â”€ DELETE /mensagens/{id} â†’ delete()
â”‚
â”œâ”€ Anexos (1)
â”‚  â””â”€ POST /atendimentos/{id}/anexos â†’ createAnexo()
â”‚
â”œâ”€ ParÃ¢metros (2)
â”‚  â”œâ”€ GET / â†’ getAll()
â”‚  â””â”€ PUT /{id} â†’ update()
â”‚
â”œâ”€ Menus (4)
â”‚  â”œâ”€ GET / â†’ list()
â”‚  â”œâ”€ GET /{id} â†’ getById()
â”‚  â”œâ”€ GET /{id}/resposta-automatica â†’ getAutoResponser()
â”‚  â””â”€ GET /submenus/{idPai} â†’ listSubmenus()
â”‚
â””â”€ HorÃ¡rios (2)
   â”œâ”€ GET / â†’ getFuncionamento()
   â””â”€ GET /aberto â†’ isOpen()
```

---

**DocumentaÃ§Ã£o criada em:** 19/11/2025  
**VersÃ£o:** 1.0  
**Status:** âœ… Completo
