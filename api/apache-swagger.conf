# SAW API - Swagger Apache Configuration
# 
# Adicione este arquivo ao seu Apache para servir a documentação Swagger
# 
# Uso:
# 1. Coloque este arquivo em: /etc/apache2/sites-available/saw-swagger.conf (Linux/Mac)
#    Ou em: C:\Apache\conf\sites-available\saw-swagger.conf (Windows)
# 
# 2. Habilite o site: a2ensite saw-swagger.conf
# 
# 3. Reinicie Apache: sudo systemctl restart apache2
#

<VirtualHost *:80>
    ServerName api.saw.local
    ServerAlias localhost:8080
    DocumentRoot "C:\xampp\htdocs\SAW-main\api"
    
    # Logs
    ErrorLog logs/saw-swagger-error.log
    CustomLog logs/saw-swagger-access.log common
    
    # Swagger UI
    <Directory "C:\xampp\htdocs\SAW-main\api">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Reescrita de URLs para Swagger
        <IfModule mod_rewrite.c>
            RewriteEngine On
            
            # Swagger UI
            RewriteRule ^swagger/?$ swagger-ui.html [L]
            RewriteRule ^swagger/$ swagger-ui.html [L]
            
            # JSON OpenAPI
            RewriteRule ^swagger/swagger\.json$ swagger.json [L]
            RewriteRule ^api/spec\.json$ swagger.json [L]
            
            # Reedirecionar /swagger para /swagger/
            RewriteRule ^swagger$ swagger/ [R=301,L]
        </IfModule>
    </Directory>
    
    # API v1
    <Directory "C:\xampp\htdocs\SAW-main\api\v1">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /api/v1/
            
            # Reescrever para index.php
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.php [L,QSA]
        </IfModule>
    </Directory>
    
    # Cabeçalhos CORS
    <IfModule mod_headers.c>
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Headers "Content-Type, Authorization"
        Header set Access-Control-Max-Age "3600"
    </IfModule>
    
    # Cache Control
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType application/json "access plus 1 hour"
        ExpiresByType text/html "access plus 1 day"
        ExpiresByType text/javascript "access plus 1 day"
        ExpiresByType text/css "access plus 1 day"
    </IfModule>
    
    # Compressão
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/javascript
        AddOutputFilterByType DEFLATE text/css
    </IfModule>
    
    # Segurança
    <Files "*.json">
        <IfModule mod_authz_core.c>
            Require all granted
        </IfModule>
    </Files>
    
    <Files ".htaccess">
        <IfModule mod_authz_core.c>
            Require all denied
        </IfModule>
    </Files>

</VirtualHost>

# Porta alternativa (8080)
<VirtualHost *:8080>
    ServerName localhost
    DocumentRoot "C:\xampp\htdocs\SAW-main\api"
    
    <Directory "C:\xampp\htdocs\SAW-main\api">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
</VirtualHost>
